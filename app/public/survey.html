<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Friend Finder</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>
<body>
    <div class= "container">
            <h2>Survey Questions</h2>
            <hr>
            <h3>About You</h3>
            <h4>Name (Required)</h4>
            <input type="text" id="name" class="form-control" required="">
            <h4>Link to Photo Image (Required)</h4>
            <input type="text" id="photo" class="form-control" required="">
            <hr>
            <h3>Question 1</h3>
            <h4> You enjoy vibrant social events with lots of people. </h4>
            <select class="chosen-select" id="q1">
                    <option value=""></option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
            </select>
            <h3>Question 2</h3>
            <h4>You often spend time exploring unrealistic yet intriguing ideas.</h4>
            <select class="chosen-select" id="q2">
                    <option value=""></option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
            </select>
            <h3>Question 3</h3>
            <h4>You often think about what you should have said in a conversation long after it has taken place.</h4>
            <select class="chosen-select" id="q3">
                    <option value=""></option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
            </select>
            <h3>Question 4</h3>
            <h4>You often rely on other people to be the ones to start a conversation and keep it going.</h4>
            <select class="chosen-select" id="q4">
                    <option value=""></option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
            </select>
            <h3>Question 5</h3>
            <h4> You rarely worry if you made a good impression on someone you met.</h4>
            <select class="chosen-select" id="q5">
                    <option value=""></option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
            </select>
            <h3>Question 6</h3>
            <h4>It would be a challenge for you to spend the whole weekend all by yourself without feeling bored.</h4>
            <select class="chosen-select" id="q6">
                    <option value=""></option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
            </select>
            <h3>Question 7</h3>
            <h4>You are very affectionate with people you care about.</h4>
            <select class="chosen-select" id="q7">
                    <option value=""></option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
            </select>
            <h3>Question 8</h3>
            <h4>You have a careful and methodical approach to life. </h4>
            <select class="chosen-select" id="q8">
                    <option value=""></option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
            </select>
            <h3>Question 9</h3>
            <h4>You are still bothered by the mistakes you made a long time ago.</h4>
            <select class="chosen-select" id="q9">
                    <option value=""></option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
            </select>
            <h3>Question 10</h3>
            <h4> You can stay calm under a lot of pressure. </h4>
            <select class="chosen-select" id="q10">
                    <option value=""></option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
            </select>                            
            <button type="submit" class="btn btn-primary btn-lg btn-block" data-toggle="modal" data-target="#myModal" id="submit"><i class="fa fa-check-circle" aria-hidden="true"></i>Submit</button>
             <!-- Modal -->
                <div class="modal fade" id="myModal" role="dialog">
                <div class="modal-dialog">
                         <!-- Modal content-->
                        <div class="modal-content">
                                <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h4 class="modal-title"></h4>
                                </div>
                <div class="modal-body">
                        <img src="" id ="friendPhoto">
                        <p class="modal-text"></p>

                </div>
                <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal" id="closeButton">Close</button>
                </div>
                        </div>
      
                </div>
                </div>
    </div>

    <footer class="footer">
        <div class="container">
                <a href="/api/friends">API Friends List</a>
                <a>|</a>
                <a href="https://github.com/RRR2019/FriendFinder">GitHub Repo</a>
        </div>
    </footer>
</body>
</html>

<script type="text/javascript">
//click event
$("#submit").on("click", function(event) {
    event.preventDefault();
    // get name and photo from user input form.
    let newName = $("#name").val(); 
    let newPhoto = $("#photo").val();
    //initialize a new friend with name and photo from user
    var newFriend = {
      name: newName,
      photo: newPhoto,
      scores: []
      };
      // get scores from form and push them into scores array in newFriend
        for(let i=1; i<11; i++){
         const score = $(`#q${i}`).val();
          const intScore = parseInt(score);
          newFriend.scores.push(intScore);
        }

      console.log(newFriend);
        // if form is not empty call postFriend with user information and call getFriends with scores array.
        if(newName.length>0 && newPhoto.length>0){
                postFriend(newFriend);
                getFriend(newFriend.scores);
                   
        }
        // if form is empty prompt user to enter name and photo link
        else{
                $(".modal-title").html("Important Message");
                $(".modal-text").html("Please add your name and photo link");
        }


});       

//function to post the newFriend
function postFriend(friend) {
        //post newFriend to API
        $.post("/api/friends", friend,
      function(data) {

        // Console log that the API was updated
        if (data) {
        console.log("updated API")     
        }

        // Clear the form when submitting
        name="";
        photo ="";
        friend.scores=[];
      });
}
// function to do an ajax call to the friend API
function getFriend(scoresArray){
        //empty results array
        let results=[];

        $.ajax({ url: "/api/friends", method: "GET" })
      .then(function(friendData) {

        // Log all API
        console.log(friendData);
        console.log("------------------------------------");
        //empty sums array
        let sums =[];
        // loop through API data, ignore the newFriend as this is the user.
        for (let i = 0; i < (friendData.length -1); i++) {
               //frindScore are the scores from all the friends in the API
               let friendScore =friendData[i].scores;
                //loop through every element in scores calculate the differences bewtween user score and friends from API score
               for(let j = 0; j < (scoresArray.length); j++){
                       //diff is the difference between each of the scores of user - scores of friends in API
                      let diff=Math.abs(scoresArray[j] - friendScore[j]); 
                      //push the differences in results array
                      results.push(diff); 
                      //console log the result array
                      console.log(results);

                       }
                       //loop through the big array of results and divide in groups of 10.
                       for(let k=0; k<(results.length/10); k++){
                                //divide results array from element 0 to 9
                                let newDiff = results.splice(0,10);
                                console.log(newDiff)
                                // function for adding two numbers
                                const add = (a, b) => a + b
                                // use reduce to sum our spliced array
                                let sum = newDiff.reduce(add);
                                //push the sum in sums array
                                sums.push(sum);
                                console.log(sums);
                                // when sums array is equal to friendDataArray minus user.
                                if(sums.length ===(friendData.length -1)){
                                        //console.log(Math.min.apply(null, sums))
                                        //get friendIndex which is the index of the minimum number in sums array
                                        let friendIndex = sums.indexOf(Math.min.apply(null, sums));
                                        console.log(friendIndex);
                                        //use friendIndex to get the best match and post their name and photo.
                                        $(".modal-title").html(friendData[friendIndex].name);
                                        $("#friendPhoto").attr("src", friendData[friendIndex].photo)
                                        $(".modal-text").html("");
                                        
                                }

                        }              
        }

       
      });
}
//when closed button is clicked clear the fields.
$("#closeButton").on("click", function(event) {
        event.preventDefault();
        $("#name").val("");
        $("#photo").val("");
        for(let i=1; i<11; i++){
         $(`#q${i}`).val("");
        }
});


</script>